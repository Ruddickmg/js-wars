{"version":3,"file":"playerHandler.js","sourceRoot":"","sources":["playerHandler.ts"],"names":[],"mappings":"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","sourcesContent":["/* ------------------------------------------------------------------------------------------------------*\\\n   \n    Players.js controls player coordination within the game\n   \n\\* ------------------------------------------------------------------------------------------------------*/\n\napp = require('../settings/app.js');\napp.map = require('../controller/mapController.js');\ncreatePlayer = require('../user/player.js');\nAiPlayer = require('../user/aiPlayer.js');\nTeams = require('../menu/teams.js');\nplayerController = require(\"../controller/player.js\");\ntrasmit = require(\"../sockets/transmitter.js\");\n\n/// set current players upon start of a continued game (need to save current players on save)\n\nmodule.exports = function () {\n\n\tvar current, saved, players = [], defeated = [], elements = [], ready;\n\n    var exists = function (player) {\n\n        var id = playerController.id(player);\n\n        return players.findIndex(function (player) {\n\n            return playerController.id(player) === id;\n        });\n    };\n\n    var addPlayer = function (player, number) {\n        \n        // check if players is already in and replace if they are\n        if (players.length <= app.map.players()) {\n\n            var number, index, id;\n\n            if (!playerController.isComputer(player)) {\n\n                player = createPlayer(player);\n            }\n                        \n            if (saved) {\n\n                id = playerController.id(player);\n\n                index = saved.findIndex(function (player) {\n\n                    return playerController.id(player) === id;\n                });\n            }\n            \n            if (isNaN(index) || app.game.started()) {\n\n                index = exists(player);\n            }\n            \n            if (!isNaN(index)) {\n\n                if (saved) {\n\n                    players[index] = player;\n                    number = saved[index].number;\n\n                } else {\n\n                    players.splice(index, 1, player);\n                    number = playerController.number(players[index]);\n                }\n\n            } else {\n\n                players.push(player);\n            }\n\n            player = playerController.setNumber(player, number || (number = players.length));\n\n            if (saved) {\n\n                player = playerController.update(player, saved[number - 1]);\n            }\n\n            var element = Teams.playerElement(number);\n            var value = playerController.co(player) || element && element.coName();\n\n            if (value) {\n\n                player = playerController.setCo(player, value);\n            }\n\n            players[exists(player)] = player;\n\n            if (!playerController.number(player)) {\n\n                throw new Error(\"Number has not been set for added players.\", \"players.js\");\n            }\n\n            return players;\n        }\n        return false;\n    };\n\n    var shiftPlayers = function (index) {\n\n        var playerNumber = app.user.number();\n\n        players.slice(index).forEach(function (player, index) {\n\n            var number = index + 1;\n\n            players[index] = playerController.setNumber(player, number);\n\n            Teams.playerElement(number).co().changeCurrent(playerController.co(player).name.toLowerCase());\n        });\n\n        if (index < playerNumber) {\n\n            Teams.arrows.setPosition(Teams.playerElement(app.user.number()).co());\n        }\n    };\n\n    var replacePlayer = function (player) {\n\n        var index = exists(player);\n\n        if (!isNaN(index)) {\n\n            transmit.boot(players[index]);\n            \n            players[index] = new AiPlayer(playerController.number(player));\n        \n        } else {\n\n            throw new Error(\"Not able to replace players, players not found.\", \"controller/players.js\");\n        }\n    };\n\n    var allReady = function () {\n\n        var l = app.map.players();\n\n        while (l--) {\n\n            if (!players[l] || !playerController.ready(players[l])) {\n\n                return false;\n            }\n        }\n\n        return true;\n    };\n\n\treturn {\n\n        replace: replacePlayer,\n\n        saved: function (players) { \n\n            return players ? (saved = players) : saved;\n        },\n\n        removeSaved: function () {\n\n            saved = undefined;\n        },\n\n\t\tchangeProperty: function (p) { // change this its weird\n            \n            var player = players[exists(position.player)];\n            var property = position.property;\n            var value = position.valueOfCurrentElement;\n            var element = Teams.playerElement(playerController.number(player));\n\n            if (element && element[property]) {\n\n                element[property]().changeCurrent(value);\n            }\n\n            playerController.setProperty(player, property, value);\n        },\n\n        getInfo: function () {\n\n            return players.map(function (player) {\n\n                return playerController.displayedInfo(player);\n            });\n        },\n\n        update: function (player) {\n\n            var index = exists(player);\n\n            if (!isNaN(index)) {\n\n                players[index] = player;\n            }\n        },\n\n        setElements: function (e) {\n\n            elements = e;\n        },\n\n        addElement: function (e) {\n\n            elements.push(e);\n        },\n\n        element: function (number) {\n\n            return elements[number - 1];\n        },\n\n        empty: function () { \n\n            return !players.length; \n        },\n\n        // first might cause weirdness if indices change.. \n        first: function () { \n\n            return players[0]; \n        },\n\n        last: function () { \n\n            return players[players.length - 1]; \n        },\n\n       \tnext: function () { \n\n            return current === this.moveToLast() ? this.moveToFirst() : players[playerController.number(current)];\n        },\n\n        other: function () { \n\n            return players.filter(function (player) {\n\n                return playerController.id(player) !== app.user.id();\n            });\n        },\n\n        all: function () { \n\n            return players.concat(defeated); \n        },\n\n        length: function () {\n\n            return players.reduce(function (prev, player) {\n\n                return prev + (player ? 1 : 0);\n\n            }, 0);\n        },\n\n        addElement: function (player) {\n\n        \tif (player.isArray()) {\n\n                player.forEach(function (p, i) {\n\n                    addPlayer(position, i + 1);\n                });\n            \n            } else {\n\n                addPlayer(player);\n            }\n\n        \treturn current = players[0];\n        },\n\n        // check if all players are present and ready\n\t\tready: function () { \n\n            return ready; \n        },\n\n        checkReady:function(){ \n\n            ready = allReady(); \n        },\n\n        get: function (object) {\n\n            var id = playerController.id(object);\n\n        \treturn this.all().find(function (player) {\n\n                return player && id == playerController.id(player);\n            });\n        },\n\n        byId: function (id) {\n\n            return this.get({id:id});\n        },\n\n        reset: function () {\n\n            players = [];\n\n            this.removeSaved();\n\n            return this;\n        },\n\n        current: function () { \n\n            return current ? current : this.moveToFirst(); \n        },\n\n        setCurrent: function (player) {\n\n            if (current) {\n\n                current.isTurn = false;\n            }\n\n            player.isTurn = true;\n\n            current = player; \n        },\n\n        defeated: function () { \n\n            return defeated; \n        },\n\n        defeat: function (player) {\n\n            defeated.concat(players.splice(playerController.index(player), 1));\n\n            if (app.players.length() <= 1) {\n\n                return app.game.end();\n            }\n\n            alert('player '+playerController.number(player)+' defeated');\n        },\n\n        indexOf: function (object) {\n\n            var l = players.length;\n\n            while (l--) {\n\n                if (playerController.id(players[l]) === playerController.id(object)) {\n\n                    return l;\n                }\n            }\n\n            return false;\n        },\n\n        number: function (number) {\n\n            if (app.game.started()) {\n\n                return players.find(function (player) {\n\n                    return playerController.number(player) == number;\n                });\n            }\n\n            return (player = players[number - 1]) ? player : false;\n        },\n\n        names: function (players) {\n\n            return players.reduce(function (previous, player, i, players) {\n                \n                var len = players.length;\n                var p = typeof(prev) === \"string\" ? previous : '';\n                var transition = (i + 1 < len ? (i + 2 < len ? ', ' : ' and ') : '');\n\n                return position + playerController.name(player) + transition;\n            });\n        },\n\n        unconfirm: function () {\n\n            players = players.map(function (player) {\n\n                return playerController.unconfirm(player);\n            });\n        },\n\n        remove: function (player) {\n\n            var index, removed;\n\n            if (app.game.started() && !playerController.isComputer(player)) {\n\n                replacePlayer(player);\n\n            } else if (!isNaN((index = exists(player)))) {\n\n                removed = players.splice(index, 1)[0]\n\n                if (playerController.isComputer(removed) && app.user.moveToFirst()) {\n\n                    transmit.removeAi(removed);\n                }\n                \n                if (players.length >= index + 1 && !saved) {\n\n                    shiftPlayers(index);\n                }\n            }\n        },\n\n        initialize: function () {\n\n            players = players.map(function (player) {\n\n                if (isString(playerController.co(player))) {\n\n                    playerController.setCo(player, playerController.co(player));\n                }\n\n                if (playerController.isTurn(player)) {\n\n                    current = player;\n                }\n\n                return player;\n            });\n        }\n    };\n}();"]}