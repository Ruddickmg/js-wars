{"version":3,"file":"gameController.js","sourceRoot":"","sources":["gameController.ts"],"names":[],"mappings":"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","sourcesContent":["/* ------------------------------------------------------------------------------------------------------*\\\n   \n    Game.js controls the setting up and selection of games / game modes \n   \n\\* ------------------------------------------------------------------------------------------------------*/\n\nStatusHud = require(\"../huds/coStatusHud.js\");\nCounter = require(\"../tools/counter.js\");\nHud = require(\"../huds/hud.js\");\ntransmit = require(\"../sockets/transmitter.js\");\n\napp = require(\"../settings/app.js\");\napp.menu = require(\"../controller/menuController.js\");\napp.animate = require(\"../animation/animationHandler.js\");\napp.key = require(\"../input/keyboard.js\");\napp.target = require(\"../controller/target.js\");\napp.user = require(\"../user/user.js\");\napp.players = require(\"../controller/players.js\");\napp.cursor = require(\"../controller/cursor.js\");\napp.options = require(\"../menu/options/optionsMenu.js\");\napp.confirm = require(\"../controller/confirmation.js\");\napp.request = require(\"../tools/request.js\");\napp.coStatus = new StatusHud();\nactions = require(\"../controller/actionsController.js\");\n\nplayerController = require(\"../controller/players.js\");\nbuildingController = require(\"../controller/building.js\");\n\nmodule.exports = function () {\n\n    var game, saved, mode, name, joined, selected, settings, map, id, created;\n    var end = false, started = false;\n    var menus = [\"optionsMenu\", \"options\", \"intel\", \"save\", \"exit\", \"yield\"];\n\n    // used for accessing the correct building array via what type of transportation the unit uses\n    var ports = { \n        air: \"airport\", \n        foot: \"base\", \n        wheels: \"base\", \n        boat: \"seaport\" \n    };\n\n    var tick = new Counter(1000);\n\n    var removeScreen = function () {\n\n        var screen = document.getElementById(\"setupScreen\");\n        screen.parentNode.removeChild(screen);\n    };\n\n    return {\n\n        tick:tick.reached,\n\n        setId: function (i) {\n\n            return id = i;\n        },\n\n        id: function () {\n\n            return id;\n        },\n\n        raw: function () {\n\n            return {\n                name: name,\n                map: app.map.raw(),\n                settings: settings,\n                players: app.players.all() // players.mapEditor(function (players) {return players.raw();})\n            };\n        },\n\n        joined: function () {\n\n            return joined;\n        },\n\n        setJoined: function (bool) {\n\n            joined = bool;\n        },\n\n        started: function () {\n\n            return started;\n        },\n\n        settings: function () {\n\n            return settings;\n        },\n\n        map: function () {\n\n            return map;\n        },\n\n        removeSaved: function () {\n\n            saved = undefined;\n\n            return this;\n        },\n\n        removeMap: function () {\n\n            map = undefined;\n\n            return this;\n        },\n\n        removeSettings: function () {\n\n            settings = undefined;\n\n            return this;\n        },\n\n        // removePlayers: function () {\n\n        //     players = undefined;\n\n        //     return this;\n        // },\n\n        // players: function () {\n\n        //     return players;\n        // },\n\n        name: function () { \n\n            return name; \n        },\n\n        category: function () {\n\n            return map.category;\n        },\n\n        room: function () {\n\n            return {\n\n                name:name, \n                category:map.category\n            };\n        },\n\n        screen: function () { \n\n            return gameScreen; \n        },\n\n        clear: function () {\n\n            // players = undefined;\n            saved = undefined;\n            settings = undefined;\n            name = undefined;\n            started = false;\n            end = false;\n        },\n\n        setName: function (n) {\n\n            return name = n;\n        },\n\n        setSettings: function (s) {\n\n            return settings = s;\n        },\n\n        // setPlayers: function (p) {\n\n        //     return players = p;\n        // },\n\n        setMap: function (m) {\n\n            return map = m;\n        },\n\n        logout: function () {\n\n            // handle logout\n            alert(\"logout!!\");\n        },\n\n        setCreated: function (c) {\n\n            created = c;\n        },\n\n        create: function (name, id) {\n\n            var room = {};\n\n            room.map = app.map.get();\n            room.name = this.setName(name);\n            room.settings = this.setSettings(settings);\n            room.max = app.map.players();\n            room.saved = app.players.saved();\n            room.category = app.map.category();\n            room.id = this.setId(id);\n\n            transmit.createRoom(room);\n        },\n\n        load: function (room) { \n\n            this.setId(room.id);\n            this.setCreated(room.created);\n\n            if (app.players.length() > 1) {\n\n                app.players.addElement(room.players);\n\n                // players = app.players.all();\n            }\n        },\n\n        setup: function (setupScreen){\n\n            // select game mode\n            if(app.user.id() && !mode) {\n\n                mode = app.menu.mode();\n            }\n\n            // if a game has been set \n            if (game) {\n\n                removeScreen();\n\n                return game === \"editor\" && app.editor.start() || started ? true : app.game.reset();\n\n            // set up the game based on what mode is being selected\n            } else if (mode) {\n\n                mode === \"logout\" ? app.game.logout() : game = app.menu[mode]();\n            }\n\n            // loop\n            window.requestAnimationFrame(app.game.setup);\n\n            if(app.key.pressed()) {\n\n                app.key.undo();        \n            }\n        },\n\n        reset: function () {\n\n            game = false;\n            mode = app.menu.mode();\n            this.setup();\n        },\n\n        start: function (game) {\n\n            if (app.players.length() !== app.map.players()) {\n\n                return false;\n            }\n\n            // set up game mapEditor\n            app.map.initialize();\n\n            // make sure players are ready\n            app.players.initialize();\n\n            // get the players whos turn it is\n            var player = app.players.current();\n\n            var hq = composer.functions([\n                buildingController.position,\n                playerController.hq\n            ], player);\n\n            var gold = app.players.saved() ? \n                playerController.gold(player):\n                playerController.income(player);\n\n            playerController.score(player).income(gold);\n            \n            app.players.update(playerController.setGold(player, gold));\n\n            // setup game huds\n            app.hud = new Hud(app.map.occupantsOf(hq));\n\n            // start game mechanics\n            app.game.loop();\n\n            // move the screen to the current players headquarters\n            app.screen.moveTo(hq);\n\n            // begin game animations\n            app.animate([\"background\", \"terrain\", \"building\", \"unit\", \"cursor\"]);\n            \n            // mark the game as started\n            return started = true;\n        },\n\n        /* --------------------------------------------------------------------------------------------------------*\\\n            \n            app.game.loop consolidates all the game logic and runs it in a loop, coordinating animation calls and \n            running the game\n\n        \\* ---------------------------------------------------------------------------------------------------------*/\n\n        update: function () { \n\n            return app.game.started() ? app.game.loop() : app.game.setup(); \n        },\n\n        loop: function () {\n\n            var confirmation = app.confirm.active();\n            var selected = app.cursor.selected();\n            var menu, options = app.options.active();\n\n            // incriment frame counter\n            tick.incriment();\n\n            if (confirmation) {\n\n                app.confirm.evaluate();\n            }\n            \n            if (app.cursor.deleting()) {\n\n                app.cursor.deleteUnit();\n            }\n\n            // if target is active, enabel target selection\n            if (app.target.active()) {\n\n                app.target.chose(selected);\n            }\n\n            // move cursor\n            if (!options && !confirmation) {\n\n                app.cursor.move();\n            }\n\n            // handle selection of objects\n            if (selected && actions.type(selected).evaluate(selected))  {\n\n                app.screen.reset();\n                \n            // display co status hud\n            } else if (!options) {\n\n                app.coStatus.display(app.players.current(), app.cursor.side(\"x\"));\n                \n                app.map.focus();\n            }\n\n            if (options) {\n\n                app.options.select();\n            }\n\n            // controls cursor selection\n            if (!options && !confirmation) {\n\n                app.cursor.select();\n            }\n\n            app.hud.listen(app.cursor, app.map, app.user, app.input);\n\n            // exit menus when esc key is pressed\n            if (app.key.pressed(app.key.esc())) {\n\n                if (app.cursor.deleting()) { \n\n                    app.cursor.selectMode();\n\n                } else if(!app.options.active() && !selected && !confirmation) {\n\n                    app.options.display();\n                    app.coStatus.hideCurrentElement();\n\n                } else if (!app.options.subMenu()) {\n\n                    app.screen.reset();\n                }\n            }\n\n            app.key.undo();\n            app.key.undoKeyUp();\n\n            tick.reset();\n            \n            return end || window.requestAnimationFrame(app.game.loop);\n        },\n\n        save:function () {\n\n            app.request.post({user:app.user.raw(), game:this.raw()}, \"games/save\", function (response) {\n\n                if (response && !response.error) {\n\n                    alert(\"ending game\");;\n                }\n            });\n        },\n\n        end: function (saved) {\n\n            // create game screen\n            alert(\"player \" + playerController.number(app.players.moveToFirst()) + \" wins!  with a score of \" + playerController.score(app.players.moveToFirst()).calculate() + \"!\");\n            end = true;\n        },\n\n        remove: function (saved) {\n\n            // transmit.removeRoom(name, id, created, saved);\n            app.input.deactivate();\n            app.maps.remove(app.map.get());\n            app.players.removeSaved();\n            this.clear();\n        }\n    };\n}();"]}